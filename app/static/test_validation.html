<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validazione</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/modern-ecommerce.css">
</head>
<body>
    <div class="container py-5">
        <h1>🧪 Test Validazione Campi</h1>
        <p>Testa la validazione in tempo reale</p>
        
        <form id="testForm">
            <!-- Nome -->
            <div class="mb-3">
                <label class="form-label fw-bold">
                    Nome Prodotto <span class="text-danger">*</span>
                </label>
                <input type="text" class="form-control form-control-lg" data-field="name" placeholder="Inserisci nome...">
                <div class="invalid-feedback d-none">Errore nome</div>
                <div class="valid-feedback d-none">
                    <i class="fas fa-check me-1"></i>Nome perfetto!
                </div>
                <div class="form-text">Min 2 caratteri</div>
            </div>

            <!-- Prezzo -->
            <div class="mb-3">
                <label class="form-label fw-bold">
                    Prezzo <span class="text-danger">*</span>
                </label>
                <div class="input-group input-group-lg">
                    <span class="input-group-text bg-success text-white">$</span>
                    <input type="number" class="form-control" data-field="price" placeholder="999">
                </div>
                <div class="invalid-feedback d-none">Errore prezzo</div>
                <div class="valid-feedback d-none">
                    <i class="fas fa-check me-1"></i>Prezzo valido!
                </div>
                <div class="form-text">$1 - $10,000</div>
            </div>

            <!-- Codice Barre -->
            <div class="mb-3">
                <label class="form-label fw-bold">
                    Codice a Barre <span class="text-danger">*</span>
                </label>
                <input type="text" class="form-control form-control-lg" data-field="barcode" placeholder="123456789012">
                <div class="invalid-feedback d-none">Errore codice</div>
                <div class="valid-feedback d-none">
                    <i class="fas fa-check me-1"></i>Codice valido!
                </div>
                <div class="form-text">Esattamente 12 cifre</div>
            </div>

            <!-- Descrizione -->
            <div class="mb-3">
                <label class="form-label fw-bold">
                    Descrizione <span class="text-danger">*</span>
                </label>
                <textarea class="form-control" rows="3" data-field="description" placeholder="Descrivi il prodotto..."></textarea>
                <div class="invalid-feedback d-none">Errore descrizione</div>
                <div class="valid-feedback d-none">
                    <i class="fas fa-check me-1"></i>Descrizione completa!
                </div>
                <div class="form-text">
                    <span id="charCount">0</span>/1000 caratteri - Min 10 caratteri
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-lg">Test Submit</button>
        </form>
    </div>

    <script>
        // Regole di validazione
        const validationRules = {
            name: {
                validate: function(value) {
                    if (!value || value.trim().length < 2) {
                        return 'Il nome deve contenere almeno 2 caratteri';
                    }
                    if (value.length > 100) {
                        return 'Il nome non può superare 100 caratteri';
                    }
                    return null;
                }
            },
            price: {
                validate: function(value) {
                    const num = parseFloat(value);
                    if (!value || isNaN(num)) {
                        return 'Inserisci un prezzo valido';
                    }
                    if (num < 1) {
                        return 'Il prezzo minimo è $1';
                    }
                    if (num > 10000) {
                        return 'Il prezzo massimo è $10,000';
                    }
                    return null;
                }
            },
            barcode: {
                validate: function(value) {
                    if (!value) {
                        return 'Il codice a barre è obbligatorio';
                    }
                    if (!/^\d{12}$/.test(value)) {
                        return 'Il codice a barre deve contenere esattamente 12 cifre';
                    }
                    return null;
                }
            },
            description: {
                validate: function(value) {
                    if (!value || value.trim().length < 10) {
                        return 'La descrizione deve contenere almeno 10 caratteri';
                    }
                    if (value.length > 1000) {
                        return 'La descrizione non può superare 1000 caratteri';
                    }
                    return null;
                }
            }
        };

        // Validazione campo
        function validateField(fieldName, value) {
            const rule = validationRules[fieldName];
            if (!rule) return { valid: true };
            const error = rule.validate(value);
            return { valid: error === null, error: error };
        }

        // Aggiorna aspetto campo
        function updateFieldState(input, isValid, errorMessage = '') {
            const container = input.closest('.mb-3');
            const validFeedback = container.querySelector('.valid-feedback');
            const invalidFeedback = container.querySelector('.invalid-feedback');
            
            // Reset classi
            input.classList.remove('is-valid', 'is-invalid');
            if (validFeedback) validFeedback.classList.add('d-none');
            if (invalidFeedback) invalidFeedback.classList.add('d-none');
            
            // DEBUG
            console.log(`Campo: ${input.dataset.field}, Valore: "${input.value}", Valido: ${isValid}, Errore: "${errorMessage}"`);
            
            if (input.value.trim() !== '') {
                if (isValid) {
                    input.classList.add('is-valid');
                    if (validFeedback) validFeedback.classList.remove('d-none');
                    console.log('✅ Campo valido - aggiunta classe is-valid');
                } else {
                    input.classList.add('is-invalid');
                    if (invalidFeedback) {
                        invalidFeedback.textContent = errorMessage;
                        invalidFeedback.classList.remove('d-none');
                    }
                    console.log('❌ Campo invalido - aggiunta classe is-invalid');
                }
            }
        }

        // Setup eventi
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Validazione inizializzata');
            
            Object.keys(validationRules).forEach(fieldName => {
                const input = document.querySelector(`[data-field="${fieldName}"]`);
                if (!input) {
                    console.warn(`⚠️ Campo ${fieldName} non trovato`);
                    return;
                }
                
                console.log(`✅ Campo ${fieldName} trovato:`, input);

                // Input event
                input.addEventListener('input', function() {
                    const validation = validateField(fieldName, this.value);
                    updateFieldState(this, validation.valid, validation.error);
                    
                    // Contatore caratteri per descrizione
                    if (fieldName === 'description') {
                        const charCount = document.getElementById('charCount');
                        if (charCount) {
                            charCount.textContent = this.value.length;
                            charCount.className = this.value.length > 800 ? 'text-warning fw-bold' : 'text-primary';
                        }
                    }
                });

                // Blur event
                input.addEventListener('blur', function() {
                    if (this.value.trim() !== '') {
                        const validation = validateField(fieldName, this.value);
                        updateFieldState(this, validation.valid, validation.error);
                    }
                });
            });

            // Form submit
            document.getElementById('testForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Test completato! Controlla la console per i log.');
            });
        });
    </script>
</body>
</html> 